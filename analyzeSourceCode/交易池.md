####交易池配置

具体位置: ``core/tx_pool.go``
> 交易池配置不多，但每项配置均直接影响交易池对交易的处理行为。配置信息由 TxPoolConfig 所定义


```go
// TxPoolConfig are the configuration parameters of the transaction pool.

//交易池配置(以太坊 geth 节点允许在启动节点时，通过参数修改以下配置)
type TxPoolConfig struct {
	//定义了一组视为local交易的账户地址。
	//任何来自此清单的交易默认均被视为 local 交易
	Locals    []common.Address // Addresses that should be treated by default as local
	
	//是否禁止local交易处理。默认为 fasle,允许 local 交易。
	//如果禁止,则来自 local 的交易均视为 remote 交易处理
	NoLocals  bool             // Whether local transaction handling should be disabled
	
	//存储local交易记录的文件名，默认是 ./transactions.rlp
	Journal   string           // Journal of local transactions to survive node restarts
	
	//定期将local交易存储文件中的时间间隔。默认为每小时一次
	Rejournal time.Duration    // Time interval to regenerate the local transaction journal

	// remote交易进入交易池的最低 Price 要求。此设置对 local 交易无效。默认值1
	PriceLimit uint64 // Minimum gas price to enforce for acceptance into the pool
	
	//替换交易时所要求的价格上调涨幅比例最低要求。任何低于要求的替换交易均被拒绝。
	PriceBump  uint64 // Minimum price bump percentage to replace an already existing transaction (nonce)

	//当交易池中可执行交易（是已在等待矿工打包的交易）量超标时，允许每个账户可以保留在交易池最低交易数。默认值是 16 笔。
	AccountSlots uint64 // Number of executable transaction slots guaranteed per account
	
	//交易池中所允许的可执行交易量上限，高于上限时将释放部分交易。默认是 4096 笔交易。
	GlobalSlots  uint64 // Maximum number of executable transaction slots for all accounts
	
	//交易池中单个账户 非可执行交易 上限，默认是64笔。
	AccountQueue uint64 // Maximum number of non-executable transaction slots permitted per account
	
	//交易池中所有非可执行交易上限，默认 1024 笔。
	GlobalQueue  uint64 // Maximum number of non-executable transaction slots for all accounts

	// 允许 remote 的非可执行交易可在交易池存活的最长时间。
	//交易池每分钟检查一次，一旦发现有超期的remote 账户，则移除该账户下的所有非可执行交易。默认为3小时。
	Lifetime time.Duration // Maximum amount of time non-executable transaction are queued
}
```
---
就像上面的交易配置，再结合下面的图像：
<img src=image/txpool-1.png>
以太坊将交易按状态分为两部分：可执行交易和非可执行交易。分别记录在``pending``容器中和`` queue``容器中
交易池先采用一个 ``txLookup`` (内部为map）跟踪所有交易。同时将交易根据本地优先，价格优先原则将交易划分为两部分 ``queue ``和 ``pending``。而这两部交易则按账户分别跟踪







##### 一些重要概念

1. ``可执行交易和非可执行交易``。``可执行交易``是指从交易池中择优选出的一部分交易可以被执行，打包到区块中。``非可执行交易``则相反，任何刚进入交易池的交易均属于非可执行状态，在某一个时刻才会提升为可执行状态。
---
2. ``本地交易`` 在交易池中将交易标记为 local 的有多种用途：
    1. 在本地磁盘存储已发送的交易。这样，本地交易不会丢失，重启节点时可以重新加载到交易池，实时广播出去。
    2. 可以作为外部程序和以太坊沟通的一个渠道。外部程序只需要监听文件内容变化，则可以获得交易清单。
    3. local交易可优先于 remote 交易。对交易量的限制等操作，不影响 local 下的账户和交易。
---
3. ``nonce``总结:
    1. 以太坊中有两种nonce，一种是在区块中的nonce，主要是调整挖矿难度；一种是每笔交易中nonce。
    2. 每个外部账户（私钥控制的账户）都有一个nonce值，从0开始连续累加，每累加一次，代表一笔交易。
    3. 某一地址的某一交易的nonce值如果大于当前的nonce，该交易会被放到交易池的queued列表中，直到缺失的nonce被提交到交易池中。
    4. 地址的nonce值是一个连续的整数，起设计的主要目的是防止双花。
    5. 在发生一笔交易时，如果不指定nonce值时，节点会根据当前交易池的交易自动计算该笔交易的nonce。有可能会出现节点A和节点B计算的nonce值不一样的情况。
---
4. 时隙 (``slots``) 和时段 (``epochs``)
   1. 信标链是以太坊2.0的心脏，它令以太坊系统在和谐与共识中有序运行。每个slot为12秒，每个epoch由32个slots组成，即6.4分钟。

   2. Epoch 0中的前32个slots，创世区块在Slot 0中产生

   3. 在每个slot中，在信标链和分片中都可能新增一个区块。我们可以想象，信标链和分片链有序且紧密地排列在一起，当系统在理想情况下运转时，每12秒就有一个信标（链）区块和64个分片区块产生。验证者大致按照这个时间同步。

   4. 我们可以将一个slot看作是区块生成时间，不同的是slots内可以没有区块。信标链和分片的创世区块都在Slot 0中产生。分片将在信标链epoch 0的下一个epoch中开始运作，但无论是分片链还是信标链，都有自己的epoch 0，且包含其创世区块。
